<?php 

session_start();

if (isset($_SESSION["username"])){
    header('Location: scoreboard.php');
    die;
}

require_once("mysqli_connect.php");
require_once("auth_functions.php");

$status = '';
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
  if (!empty($_POST['username']) && !empty($_POST['password'])){

      $userID = login_check($dbc, $_POST['username'], $_POST['password']);
      if ($userID){    
          session_regenerate_id();
          $_SESSION["username"] = $_POST['username'];
          $_SESSION["userID"] = $userID;

          if (isset($_SESSION["redirectURL"])){
              header('Location: ' . $_SESSION["redirectURL"]);
          }
          else{
              header('Location: scoreboard.php');
          }
          die;
      } 
      else {
          $status = '<div style="color:red">Incorrect</div>';
      }   
  }
  else {
      $status = '<div style="color:red">Please enter a Username & Password</div>';
  } 
}

require_once('header.php');
echo '
  <h2>Login </h2>
  ' . $status . '
  <form name="login" method="post" action="' . $_SERVER['PHP_SELF'] . '">
   <input type="text" placeholder="Username" name="username" autocomplete="off" required>
   <input type="password" placeholder="Password" name="password" autocomplete="off" required>
   <input type="submit" name="submit" value="Login!">
  </form>

<h2>Forgot a password? Need to register?</h2>

Please <a HREF="mailto:webmaster@example.com?subject=PentestCTF&body=">email an admin</a>, help is on the way!'; 

?>
<?php include 'footer.php';?>
