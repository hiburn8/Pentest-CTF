<?php

function createbuttons(){
  $buttons = '<li><a href="scoreboard.php"> Scoreboard </a></li>
              <li><a href="labs.php"> Labs </a></li>
              <li><a href="info.php"> Info </a></li>';

  if (isset($_SESSION["username"])) {
    //$buttons .= '<li><a href="addlab.php"> Add a lab! </a></li>';
    $buttons .=  '<li><a href="submit.php"> Submit flag</a></li>
                  <li><a href="submitlab.php"> Create a lab </a></li>
                  <li><a href="logout.php"> Logout (' . $_SESSION["username"] . ')</a></li>';

    if ($_SESSION["username"] == 'admin'){
      $buttons .= '<li><a href="api.php"> *API* </a></li>
                   <li><a href="adduser.php"> *Add user* </a></li>';
    }
  }
  else{
      $buttons .= '<li><a href="login.php"> Login </a></li>';
  }
  return $buttons;
}

function createwelcome(){
  if (isset($_SESSION["username"])) {
      return '<h3>' . $_SESSION["username"] . '</u></h3>';
    }
}


function getNews($dbc) {
  $latestcompletion = "SELECT users.username, labs.labname, pwns.completed FROM `pwns` INNER JOIN users ON pwns.userID=users.userID INNER JOIN labs ON labs.labID=pwns.labID ORDER BY completed DESC LIMIT 1";
  $lstpwn = $dbc->query($latestcompletion);

  while( $row = $lstpwn->fetch_assoc()){
    $username = $row["username"]; 
    $labname = $row["labname"];
    $completed = $row["completed"];
  }
  if(isset($labname) && isset($username)){ 
    echo '<marquee  behavior="scroll" direction="left" scrollamount="2"> Congratulations to '. $username . ', who recently completed "' . $labname . '"!</marquee> ';
  }
}

getNews($dbc);
?>

<!DOCTYPE html>
<html>
<head>

  <?php 
  if(basename($_SERVER['PHP_SELF']) == 'submitlab.php') { 
    echo '<script type="text/javascript" src="googlechart/googlechart.js"></script>'; 
  } 
  elseif (basename($_SERVER['PHP_SELF']) == 'labs.php') {
    echo '  <script src="//code.jquery.com/jquery-1.10.2.js"></script> <script src="//code.jquery.com/ui/1.11.3/jquery-ui.js"></script>';
  }
  elseif (basename($_SERVER['PHP_SELF']) == 'scoreboard.php') {
    echo '<script type="text/javascript" src="http://code.jquery.com/jquery-2.1.3.min.js"></script>';
    echo '<script type="text/javascript" src="http://mottie.github.com/tablesorter/js/jquery.tablesorter.js"></script>';
  }
  ?>



  <link rel="stylesheet" href="style.css">
</head>
<body>
<p><img src="PenCTF.png" height="100" width="275"></p>
<nav>
  <ul id="nav">
    <?php echo createbuttons(); ?>
  </ul>
</nav>
<div id="content">