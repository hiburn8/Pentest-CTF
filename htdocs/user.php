<?php 

session_start();
require_once("mysqli_connect.php");
require_once('header.php');
require_once('functions.php');

$id = $_GET["id"];
$completedlabs = getlabsfromUserID($dbc, $id);
$authoredlabs = getauthoredlabsfromUserID($dbc, $_GET["id"]);



?>
<h2><?php echo ucfirst(getusernamefromUserID($dbc, $id)); ?></h2>

<h3>Flags Captured</h3>
<ol>
<?php
if ($stmt = $dbc->prepare("SELECT labs.labname, labs.category ,labs.difficulty, labs.created, pwns.completed FROM `pwns` INNER JOIN labs ON labs.labID=pwns.labID INNER JOIN users on users.userID=pwns.userID WHERE users.userID = ? ORDER BY completed")) {

    $stmt->bind_param('i', $id);
    $stmt->execute(); 
    $stmt->store_result();
    $stmt->bind_result($labname, $category, $difficulty, $created, $completed);
    
    while ($stmt->fetch()) {
      echo '<li><b>' . categoryIcon($category) . $labname . '</b> (' . $difficulty . ' points) (~' . timeBetween(strtotime($completed),-1) . ' ago)</li>';
    }
}
?>
</ol>


<h3>Labs Authored</h3>
<ol>
<?php
if ($stmt = $dbc->prepare("SELECT labname, category, difficulty, created, status FROM labs WHERE authorID = ? ORDER BY created")) {

    $stmt->bind_param('i', $id);
    $stmt->execute(); 
    $stmt->store_result();
    $stmt->bind_result($labname, $category, $difficulty, $created, $status);
    
    while ($stmt->fetch()) {
      echo '<li><b>' . categoryIcon($category) . $labname . '</b> (' . $difficulty . ' points) (~' . timeBetween(strtotime($created),-1) . ' old)</li>';
    }
}
?>
</ol>

<?php include 'footer.php';?>
