<?php 

session_start();

if (isset($_SESSION["username"])){
    header('Location: scoreboard.php');
}

require_once("mysqli_connect.php");
require_once("auth_functions.php");

if (isset($_POST['username']) && isset($_POST['password'])){

    $userID = login_check($dbc, $_POST['username'], $_POST['password']);
    if ($userID){    
        session_regenerate_id();
        $_SESSION["username"] = $_POST['username'];
        $_SESSION["userID"] = $userID;

        if (isset($_SESSION["redirectURL"])){
            header('Location: ' . $_SESSION["redirectURL"]);
        }
        else{
            header('Location: scoreboard.php');
        }
        die;
    } 
    else { 
        require_once('header.php');
        echo 'Username/Password Invalid';
    }
    
} else {

require_once('header.php');
echo '
  <h2>You must login to do that </h2>
  <form name="login" method="post" action="' . $_SERVER['PHP_SELF'] . '">
   Username: <input type="text" name="username"><br>
   Password: <input type="password" name="password"><br>
   <input type="submit" name="submit" value="Login!">
  </form>';

}?>

<?php include 'footer.php';?>